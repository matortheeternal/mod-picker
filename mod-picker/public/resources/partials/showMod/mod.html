<two-columns>
    <loader data="mod" spinner-class="big-spinner">
        <div class="mod-header-color">
            <div class="page-container mod-header">
                <section>
                    <div class="quality-item action-box" ng-if="mod.primary_category_id">
                        <span class="quality-number">{{mod.reputation | number:0}}</span>
                        REPUTATION
                    </div>

                    <div class="mod-info">
                        <span class="mod-name">{{mod.name}}</span>
                        <span class="mod-authors-container">by
                            <span class="mod-authors">{{mod.authors}}</span>
                        </span>
                        <!--<span ng-repeat="author in mod.authors">
                            <a ng-href="#/user/{{author.id}}">{{author.username}}</a>
                        </span>-->
                        <br>
                        <span ng-if="mod.primary_category_id">
                            {{mod.reviews_count | number}} reviews
                        </span>
                        <!-- TODO: add this with css :after content -->
                        <span class="divider" ng-if="mod.primary_category_id && (mod.aliases || permissions.canManage)">
                            |
                        </span>

                        <!--Included in <a ng-href="#/modlists/includingMod/{{mod.id}}">{{mod.mod_modlists_count}} modlists</a>
                        <span class="divider">
                            |
                        </span>-->

                        <span ng-if="mod.aliases">
                            <strong>Aliases: </strong>{{mod.aliases}}
                            <span class="divider" ng-if="permissions.canManage">
                                |
                            </span>
                        </span>

                        <a ng-href="#/mod/{{mod.id}}/edit" ng-if="permissions.canManage">Edit</a>
                    </div>
                </section>

                <section>
                    <div class="mod-header-box">
                        <!-- TODO: I feel like using some spans here would be wiser -->
                        ACTIONS
                        <div class="action-box" ng-click="starMod()">
                            <i class="fa {{modStarred ? 'fa-star' : 'fa-star-o'}}" aria-hidden="true"></i>
                            {{modStarred ? 'Unfavorite' : 'Favorite'}}
                        </div>
                        <div class="action-box">
                            <i class="fa fa-plus" aria-hidden="true"></i>
                            Add to mod list
                        </div>
                    </div>

                    <div class="mod-header-box" ng-if="mod.primary_category_id">
                        STATUS
                        <div class="action-box {{statusClass}} capitalize" ng-click="toggleStatusModal(true)">
                            {{mod.status}}
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <div class="modal-container" ng-if="showStatusModal">
            <div class="modal huge-modal">
                <div class="close-modal">
                    <span class="fa fa-times" ng-click="toggleStatusModal(false)"></span>
                </div>

                <h2>
                    {{mod.name}}
                    <span class="static-box {{statusClass}} capitalize">
                        {{mod.status}}
                    </span>
                </h2>
                <p ng-show="permissions.canAppeal">
                    If you'd like to contest this mod's status you can submit an appeal to change it
                    which will then be reviewed by the community over one week.  If enough users agree
                    with your appeal, the mod's status will be changed.  You can vote on and participate
                    in discussion on any currently open appeals.
                </p>
                <p ng-hide="permissions.canAppeal">
                    You don't have enough reputation to submit an appeal to change this mod's status.
                    You can view past appeals and discussions, but will not be able to vote on them or
                    participate in discussion until you have gained more reputation.
                </p>
                <p>
                    <a href="/help/Appeals_Process">Click here</a> for more information.
                </p>

                <h3 class="section-title">Appeals</h3>
                <loader data="mod.corrections" content-class="appeals-container" spinner-class="big-spinner">
                    <table ng-if="mod.corrections.length > 0">
                        <thead>
                        <tr>
                            <td>Title</td>
                            <td>Date Submitted</td>
                            <td>Submitted by</td>
                            <td>Comments</td>
                            <td>Status</td>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="appeal in mod.corrections" ng-class="{ 'appeal-hidden' : appeal.hidden }">
                            <td class="main-cell">
                                <a ng-click="showAppeal(appeal.id)">
                                    {{appeal.title}}
                                </a>
                            </td>
                            <td>{{appeal.submitted | date}}</td>
                            <td>
                                <a ng-href="#/profile/{{appeal.submitted_by}}">
                                    {{appeal.user.username}}
                                </a>
                            </td>
                            <td>{{appeal.comments_count}}</td>
                            <td>
                                <span ng-if="appeal.status === 'open'">{{appeal.agree_count / (appeal.agree_count + appeal.disagree_count) | number:0}}% Agree</span>
                                <div ng-if="appeal.status !== 'open'" class="action-box appeal-{{appeal.status}} capitalize">
                                    {{appeal.status}}
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <span ng-if="mod.corrections.length == 0">
                        There have been no appeals on this mod's status.
                    </span>
                </loader>

                <div class="action-button-container" ng-if="appealStatus">
                    <input class="btn action-btn" type="submit" ng-click="startNewAppeal()" value="New Appeal">
                </div>
            </div>
        </div>

        <messages success-bool="showSuccess" errors="errors" success-message="{{submitMessage}}">
        </messages>

        <div class="page-container">
            <loader data="mod" spinner-class="big-spinner">
                <div class="left-column left-mod-column wide-column">

                    <!--Image-->
                    <img ng-src="{{mod.image}}" class="mod-image"/>

                    <!-- General -->
                    <h3 class="section-title">General</h3>
                    <div class="stat-block">
                        <section>
                            <dt class="stat-title">Date Released</dt>
                            <dd class="stat-data">{{mod.released | date}}</dd>

                            <dt class="stat-title" ng-if="mod.updated">Date Updated</dt>
                            <dd class="stat-data" ng-if="mod.updated">{{mod.updated | date}}</dd>
                        </section>
                    </div>

                    <!--Sources-->
                    <h3 class="section-title">Sources</h3>
                    <section class="sources">
                        <source-link source="mod.nexus_infos" label="Nexus Mods" link="http://www.nexusmods.com/{{game.nexus_name}}/mods/{{mod.nexus_infos.id}}"></source-link>
                        <source-link source="mod.workshop_infos" label="Steam Workshop" link="http://steamcommunity.com/sharedfiles/filedetails/{{mod.workshop_infos.id}}"></source-link>
                        <source-link source="mod.lover_infos" label="Lover's Lab" link="http://www.loverslab.com/files/file/{{mod.lover_infos.id}}"></source-link>
                        <source-link ng-repeat="source in mod.custom_sources" source="source" label="{{source.label}}" link="{{source.url}}"></source-link>
                    </section>

                    <!--Requirements-->
                    <h3 ng-if="mod.required_mods.length > 0" class="section-title">Requirements</h3>
                    <section ng-if="mod.required_mods.length > 0">
                        <ol class="requirements-list">
                            <li ng-repeat="req in mod.required_mods">
                                <a ng-href="#/mod/{{req.required_mod.id}}">
                                    {{req.required_mod.name}}
                                </a>
                            </li>
                        </ol>
                    </section>

                    <!-- We hide categories and tags when viewing a mod with no primary category -->
                    <div ng-if="mod.primary_category_id">
                        <!--Categories-->
                        <h3 class="section-title">Categories</h3>
                        <section>
                            <div class="action-box">{{primaryCategory.name}}</div>
                            <div ng-show="mod.secondary_category_id" class="action-box">{{secondaryCategory.name}}</div>
                        </section>

                        <!--Tags-->
                        <h3 class="section-title">Tags</h3>
                        <section>
                            <tag-selector active-tags="mod.tags" new-tags="newTags" max-tags="10" show-mods-count="true" show-add="true" can-create="permissions.canCreateTags" show-remove="permissions.canManage" save-callback="saveTags"></tag-selector>
                        </section>
                    </div>

                    <!--Site Stats-->
                    <stat-expander info="mod.nexus_infos" expanded="nexusExpanded" label="Nexus Mods">
                        <nexus-stats></nexus-stats>
                    </stat-expander>
                    <stat-expander info="mod.workshop_infos" expanded="workshopExpanded" label="Steam Workshop">
                        <workshop-stats></workshop-stats>
                    </stat-expander>
                    <stat-expander info="mod.lover_infos" expanded="labExpanded" label="Lover's Lab">
                        <lab-stats></lab-stats>
                    </stat-expander>

                </div>
                <div class="right-column tabs-column">
                    <tabs current-tab="currentTab" on-change="switchTab" tabs="tabs"></tabs>
                    <div ng-include="currentTab.url" class="mod-tab"></div>
                </div>
            </loader>
        </div>
    </loader>
</two-columns>
