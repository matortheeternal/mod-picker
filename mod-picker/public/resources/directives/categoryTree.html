<h3 id="categories-section-title" class="section-title">Categories
    <span class="filter-controls">
        <span class="fa fa-eraser" ng-click="clearSelection()" title="Clear Selection"></span>
        <span class="fa fa-adjust" ng-click="invertSelection()" title="Invert Selection"></span>
    </span>
</h3>

<div class="sidebar-box">
    <div class="category-tree">
        <div ng-repeat="primaryCategory in categories">
            <expandable expanded="categories[$index].expanded" disable-style="true" disable-full-title-toggle="true" ng-if="primaryCategory.childs.length">
                <expanded-title>
                    <label class="supercategory">
                        <input type="checkbox" ng-model="categories[$index].value" ng-indeterminate="categories[$index].indeterminate" ng-change="updateSelection($index)"/>
                        <span>{{primaryCategory.name}}</span>
                    </label>
                </expanded-title>
                <content>
                    <div class="sub-category" ng-repeat="secondaryCategory in primaryCategory.childs">
                        <label>
                            <input type="checkbox" ng-model="categories[$parent.$index].childs[$index].value" ng-change="updateSelection($parent.$index, $index)"/>
                            <span>{{secondaryCategory.name}}</span>
                        </label>
                    </div>
                </content>
            </expandable>

            <!-- TODO: kill duplication-->
            <!-- Improved slightly using ng-if, now the HTML served to the user isn't quite as polluted -->
            <div ng-if="!primaryCategory.childs.length">
                <div class="expandable-title-container">
                    <span class="no-icon"></span>
                    <label class="supercategory">
                        <input type="checkbox" ng-model="categories[$index].value" ng-indeterminate="categories[$index].indeterminate" ng-change="updateSelection($index)"/>
                        <span>{{primaryCategory.name}}</span>
                    </label>
                </div>
            </div>
        </div>
    </div>
</div>
